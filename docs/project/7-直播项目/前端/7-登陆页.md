# 登录页

## 静态模板

```html
<template>
	<view class="position-relative">
		<view :style="'height:' + statusBarHeight + 'px;'"></view>
		<view style="height: 44px;" class="flex align-center" @click="back">
			<view style="width: 44px;height: 44px;" class="flex align-center justify-center animated fast" hover-class="text-main pulse">
				<text class="iconfont iconguanbi font-lg"></text>
			</view>
		</view>

		<view class="flex align-center justify-center font-lg font-weight-bold text-muted" style="margin-top: 100rpx;margin-bottom: 80rpx;">注 册</view>

		<view class="px-4">
			<input type="text" class=" bg-light rounded mb-4 px-3 font" placeholder="请输入用户名" style="height: 100rpx;" v-model="form.username" />
			<view class="uni-input-wrapper bg-light justify-center mb-4">
				<input
					style="height: 28px;line-height: 28px;font-size: 15px;padding: 0px;flex: 1;"
					class="bg-light"
					placeholder="请输入密码"
					:password="showPassword"
					v-model="form.password"
				/>
				<text class="uni-icon" :class="[!showPassword ? 'uni-eye-active' : '']" @click="changePassword">&#xe568;</text>
			</view>
			<view class="uni-input-wrapper bg-light justify-center">
				<input
					style="height: 28px;line-height: 28px;font-size: 15px;padding: 0px;flex: 1;"
					class="bg-light"
					placeholder="请输入确认密码"
					:password="showRepassword"
					v-model="form.repassword"
				/>
				<text class="uni-icon" :class="[!showRepassword ? 'uni-eye-active' : '']" @click="changeRepassword">&#xe568;</text>
			</view>
		</view>
		<!-- <view class="px-4" v-else>
			<input type="text" class="uni-input bg-light rounded mb-4" placeholder="请输入用户名" v-model="loginForm.username" key="lu" />
			<input type="password" class="uni-input bg-light rounded mb-4" placeholder="请输入密码" v-model="loginForm.password" key="lp" />
		</view> -->

		<!-- 点击注册 -->
		<view class="px-4 mt-5 mb-2"><main-big-button @click="submit">注 册</main-big-button></view>

		<view class="flex align-center justify-center py-5">
			<view style="height: 1rpx;width: 100rpx; background-color: #E3E1DD;"></view>
			<view class="text-muted mx-2 font-sm">社交账号注册(未开放)</view>
			<view style="height: 1rpx;width: 100rpx;background-color: #E3E1DD;"></view>
		</view>

		<view class="flex align-center px-5" style="color: #ccc;">
			<view class="flex align-center justify-center flex-1">
				<view style="width: 100rpx;height: 100rpx;" class="rounded-circle flex align-center justify-center bg-light"><text class="iconfont iconqq font-lg"></text></view>
			</view>
			<view class="flex align-center justify-center flex-1">
				<view style="width: 100rpx;height: 100rpx;" class="rounded-circle flex align-center justify-center bg-light"><text class="iconfont iconweixin font-lg"></text></view>
			</view>
			<view class="flex align-center justify-center flex-1">
				<view style="width: 100rpx;height: 100rpx;" class="rounded-circle flex align-center justify-center bg-light"><text class="iconfont iconweibo font-lg"></text></view>
			</view>
		</view>

		<view class="flex align-center justify-center py-5"><view class="text-muted mx-2 font-sm border-bottom" @click="goLogin">已经有账号了？去登陆</view></view>
	</view>
</template>

<script>
import mainBigButton from '@/components/common/main-big-button.vue';

export default {
	components: {
		mainBigButton
	},
	data() {
		return {
			showPassword: true,
			showRepassword: true,
			form: {
				username: '',
				password: '',
				repassword: ''
			}
		};
	},
	onLoad() {
		this.statusBarHeight = uni.getSystemInfoSync().statusBarHeight;
	},
	methods: {
		back() {
			uni.switchTab({
				url: '../my/my'
			});
		},
		changePassword: function() {
			this.showPassword = !this.showPassword;
		},
		changeRepassword: function() {
			this.showRepassword = !this.showRepassword;
		},
		goLogin() {
			uni.navigateTo({
				url: '../login/login',
				animationType: 'zoom-fade-out',
				animationDuration: 200
			});
		},
		async submit() {
			let username = await this.$H.post('/reg', this.form);
			uni.showToast({
				title: '注册成功',
				icon: 'none',
				mask: true,
				duration: 700,
				success: () => {
					setTimeout(()=>{
						uni.navigateTo({
							url: '../login/login?u='+username
						});
					},701)
				}
			});
		}
	}
};
</script>

<style scoped>
.nvue-page-root {
	background-color: #f8f8f8;
	padding-bottom: 20px;
}

.page-title {
	/* #ifndef APP-NVUE */
	display: flex;
	/* #endif */
	flex-direction: row;
	justify-content: center;
	align-items: center;
	padding: 35rpx;
}

.page-title__wrapper {
	padding: 0px 20px;
	border-bottom-color: #d8d8d8;
	border-bottom-width: 1px;
}

.page-title__text {
	font-size: 16px;
	height: 48px;
	line-height: 48px;
	color: #bebebe;
}

.title {
	padding: 5px 13px;
}

.uni-form-item__title {
	font-size: 16px;
	line-height: 24px;
}

.uni-input-wrapper {
	/* #ifndef APP-NVUE */
	display: flex;
	/* #endif */
	padding: 8px 13px;
	flex-direction: row;
	flex-wrap: nowrap;
}

.uni-icon {
	font-family: uniicons;
	font-size: 24px;
	font-weight: normal;
	font-style: normal;
	width: 24px;
	height: 24px;
	line-height: 24px;
	color: #999999;
}

.uni-eye-active {
	color: #ff0a60;
}
</style>

```

## 登录和用户信息存储

```js
async submit() {
    let res = await this.$H.post('/login', this.form);
    uni.showToast({
        title: '登录成功',
        icon: 'none',
    });
    uni.switchTab({
        url:'../my/my'
    })
}
```

```js
import Vue from 'vue'
import Vuex from 'vuex'
Vue.use(Vuex)
export default new Vuex.Store({
    state: {
        user: null,
        token: null
    },
    mutations: {
        setUser: (state, user) => {
            state.user = user
        },
        setToken: (state, token) => {
            state.token = token
        },
    },
    actions: {
        //登录
        login({
            commit
        }, userform) {
            return new Promise((resolve, reject) => {
                commit('setUser', userform)
                commit('setToken', userform.token)
                uni.setStorageSync('user', JSON.stringify(userform))
                uni.setStorageSync('token', userform.token)
                resolve()
            })
        }
    }
})
```

## 登录信息持久保存

```js
actions: {
    initUser({
        commit
    }) {
        let u = uni.getStorageSync('user')
        let token = uni.getStorageSync('token')
        if (u) {
            u = JSON.parse(u)
            commit('setUser', u)
            commit('setToken', token)
        }
    },
}
```

登录

```js
onLaunch: function() {
    //初始化用户登录
    this.$store.dispatch('initUser');
},
```

